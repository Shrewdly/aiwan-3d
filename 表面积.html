<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ†æŸ±ä½“è¡¨é¢ç§¯å¤§æ¢ç§˜</title>
    <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'global' }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>

    <style>
        :root {
            --primary: #ff6b81; /* ç¤¼ç›’çº¢ */
            --secondary: #70a1ff; /* ç§‘æŠ€è“ */
            --accent: #ffa502; /* æ´»åŠ›æ©™ */
            --bg: #f7f1e3;
            --text: #2f3542;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 20px;
        }

        .container { max-width: 900px; margin: 0 auto; }

        header {
            text-align: center; padding: 30px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white; border-radius: 20px;
            box-shadow: 0 10px 25px rgba(255, 107, 129, 0.3); margin-bottom: 30px;
        }

        .card {
            background: white; border-radius: 20px; padding: 30px;
            margin-bottom: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 2px solid transparent; opacity: 0.5; pointer-events: none; filter: grayscale(1);
            transition: all 0.5s ease;
        }
        .card.active { opacity: 1; pointer-events: auto; filter: grayscale(0); border-color: var(--secondary); }
        .card.completed { border-color: #2ed573; background: #f0fff4; }

        h2 { border-left: 5px solid var(--primary); padding-left: 15px; color: var(--text); }

        /* ================= èˆå°åŒºåŸŸï¼ˆä¿®å¤BUGçš„æ ¸å¿ƒï¼‰ ================= */
        .stage-area {
            height: 400px; background: #fff; border-radius: 15px;
            display: flex; justify-content: center; align-items: center;
            position: relative; overflow: hidden; border: 2px dashed #ccc;
        }

        /* 1. åˆå§‹åœ†æŸ±ä½“ */
        .cylinder-wrapper {
            position: absolute; width: 140px; height: 200px; cursor: pointer;
            transition: transform 0.3s; z-index: 10;
        }
        .cylinder-wrapper:hover { transform: scale(1.05); }
        .cylinder-body {
            width: 100%; height: 100%;
            background: linear-gradient(90deg, #ff6b81, #ff4757, #ff6b81);
            border-radius: 50% / 10%; position: relative;
        }
        .cylinder-top {
            position: absolute; top: -15px; width: 100%; height: 30px;
            background: #ff7f90; border-radius: 50%; border: 1px solid #c44556;
        }
        .cylinder-bottom {
            position: absolute; bottom: -15px; width: 100%; height: 30px;
            background: #ff6b81; border-radius: 50%; border: 1px solid #c44556;
        }
        .ribbon {
            position: absolute; top: 0; left: 50%; width: 20px; height: 100%;
            background: var(--accent); transform: translateX(-50%);
        }
        .click-hint {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7); color: white; padding: 5px 15px;
            border-radius: 20px; font-size: 0.9em; pointer-events: none; white-space: nowrap;
        }

        /* 2. å±•å¼€åçš„é›¶ä»¶ (é»˜è®¤éšè—) */
        .unwrapped-parts {
            display: none; /* å…³é”®ä¿®å¤ï¼šåˆå§‹å½»åº•éšè— */
            width: 100%; height: 100%;
            flex-direction: row; justify-content: space-around; align-items: center;
            animation: fadeInParts 1s ease forwards;
        }
        
        @keyframes fadeInParts {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .part-group { text-align: center; display: flex; flex-direction: column; align-items: center; }
        
        .shape-circle {
            width: 100px; height: 100px; background: #a29bfe; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            border: 2px solid #6c5ce7; font-weight: bold; color: white; margin: 10px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        .shape-rect {
            width: 180px; height: 120px; background: #74b9ff;
            display: flex; justify-content: center; align-items: center;
            border: 2px solid #0984e3; font-weight: bold; color: white;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        .label-tag {
            background: #fff; border: 1px solid #ccc; padding: 2px 8px;
            border-radius: 10px; font-size: 0.85em; margin-top: 5px; color: #555;
        }

        /* ================= çŒœæƒ³é€‰é¡¹ ================= */
        .guess-options {
            display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;
        }
        .guess-btn {
            flex: 1; min-width: 200px; padding: 15px;
            border: 2px solid #ddd; border-radius: 10px; background: white;
            cursor: pointer; text-align: left; transition: all 0.3s;
        }
        .guess-btn:hover { border-color: var(--secondary); background: #f0f9ff; }
        .guess-btn.selected { border-color: var(--accent); background: #fffaf0; box-shadow: 0 0 0 2px var(--accent); }

        /* ================= æ‹¼å›¾ä¸è¾“å…¥ ================= */
        .calc-box {
            background: #f1f2f6; padding: 20px; border-radius: 10px; margin-top: 15px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .input-area { display: flex; align-items: center; gap: 10px; }
        input { padding: 8px; border-radius: 5px; border: 1px solid #ccc; width: 80px; text-align: center;}
        
        .puzzle-piece {
            width: 60px; height: 60px; background: #dfe6e9; border: 2px dashed #b2bec3;
            border-radius: 8px; display: flex; justify-content: center; align-items: center;
            font-size: 2em; transition: 0.5s;
        }
        .puzzle-piece.unlocked {
            background: var(--accent); border-style: solid; color: white;
            transform: rotate(10deg) scale(1.1);
        }

        button.btn-main {
            background: var(--secondary); color: white; border: none;
            padding: 10px 25px; border-radius: 20px; font-size: 1em; cursor: pointer;
        }
        button.btn-main:hover { background: #5f27cd; }
        button:disabled { background: #ccc; cursor: not-allowed; }

        /* ç»“è®ºåŒº */
        .conclusion-box {
            display: none; background: #2f3542; color: white; padding: 20px;
            border-radius: 15px; margin-top: 20px; text-align: center;
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ ç¤¼ç›’æ‹†æ‹†ä¹</h1>
    <p>ä»»åŠ¡ï¼šè§£å¼€åœ†æŸ±ä½“è¡¨é¢ç§¯çš„ç§˜å¯†</p>
</header>

<div class="container">

    <section class="card active" id="stage1">
        <h2>ç¬¬ä¸€æ­¥ï¼šæ‹†å¼€ç¥ç§˜ç¤¼ç›’</h2>
        <p>è¿™æ˜¯ä¸€ä¸ªåœ†æŸ±ä½“ç¤¼ç›’ã€‚è®¾è®¡å¸ˆè¯´ï¼Œæ•´ä¸ªç¤¼ç›’çš„è¡¨é¢ç§¯ï¼ˆåŒ…è£…çº¸é¢ç§¯ï¼‰ä¸€å…±æ˜¯ <strong><span id="totalAreaDisp"></span> cmÂ²</strong>ã€‚</p>
        <p>è¯·ç‚¹å‡»ç¤¼ç›’ï¼ŒæŠŠå®ƒæ‹†å¼€ï¼Œçœ‹çœ‹å®ƒæ˜¯ç”±å“ªäº›å›¾å½¢ç»„æˆçš„ï¼Ÿ</p>
        
        <div class="stage-area">
            <div class="cylinder-wrapper" id="cylinderGift" onclick="unwrapGift()">
                <div class="cylinder-top"></div>
                <div class="cylinder-body"></div>
                <div class="cylinder-bottom"></div>
                <div class="ribbon"></div>
                <div class="click-hint">ğŸ‘‡ ç‚¹æˆ‘æ‹†å¼€</div>
            </div>

            <div class="unwrapped-parts" id="unwrappedParts">
                <div class="part-group">
                    <div class="shape-circle">åº•é¢</div>
                    <div class="label-tag">åŠå¾„ $r=5$</div>
                </div>
                <div class="part-group">
                    <div class="shape-rect">ä¾§é¢</div>
                    <div class="label-tag">å®½ $h=10$</div>
                    <div class="label-tag">é•¿ $C=31.4$</div>
                </div>
                <div class="part-group">
                    <div class="shape-circle">åº•é¢</div>
                    <div class="label-tag">åŠå¾„ $r=5$</div>
                </div>
            </div>
        </div>
    </section>

    <section class="card" id="stage2">
        <h2>ç¬¬äºŒæ­¥ï¼šæˆ‘æ˜¯å°å°çŒœæƒ³å®¶</h2>
        <p>è§‚å¯Ÿä¸Šé¢æ‹†å¼€çš„å›¾å½¢ï¼Œä½ è®¤ä¸ºåœ†æŸ±ä½“çš„<strong>è¡¨é¢ç§¯</strong>ç­‰äºä»€ä¹ˆï¼Ÿè¯·é€‰æ‹©ä½ çš„çŒœæƒ³ï¼š</p>
        
        <div class="guess-options">
            <div class="guess-btn" onclick="selectGuess(1, this)">
                <strong>çŒœæƒ³ Aï¼š</strong><br>
                åªè®¡ç®—é•¿æ–¹å½¢çš„é¢ç§¯
            </div>
            <div class="guess-btn" onclick="selectGuess(2, this)">
                <strong>çŒœæƒ³ Bï¼š</strong><br>
                1ä¸ªåœ†çš„é¢ç§¯ + é•¿æ–¹å½¢é¢ç§¯
            </div>
            <div class="guess-btn" onclick="selectGuess(3, this)">
                <strong>çŒœæƒ³ Cï¼š</strong><br>
                2ä¸ªåœ†çš„é¢ç§¯ + é•¿æ–¹å½¢é¢ç§¯
            </div>
        </div>
        <div id="guessFeedback" style="margin-top:15px; color:var(--secondary); font-weight:bold; display:none;">
            ä½ çš„çŒœæƒ³å·²è®°å½•ï¼ç°åœ¨è®©æˆ‘ä»¬é€šè¿‡è®¡ç®—æ¥éªŒè¯å®ƒå§ï¼ğŸ‘‡
        </div>
    </section>

    <section class="card" id="stage3">
        <h2>ç¬¬ä¸‰æ­¥ï¼šè®¡ç®—æœé›†æ‹¼å›¾</h2>
        <p>åˆ†åˆ«ç®—å‡ºå›¾å½¢çš„é¢ç§¯ï¼ŒéªŒè¯ä½ çš„çŒœæƒ³ã€‚æ¯ç®—å¯¹ä¸€ä¸ªï¼Œè·å¾—ä¸€å—æ‹¼å›¾ï¼</p>

        <div class="calc-box">
            <div>
                <strong>ä»»åŠ¡ 1ï¼š</strong>ç®—å‡º 1 ä¸ªåœ†åº•é¢çš„é¢ç§¯<br>
                <small style="color:#666">å…¬å¼æç¤ºï¼š$\pi r^2$ ($3.14 \times 5^2$)</small>
            </div>
            <div class="input-area">
                <input type="number" id="ansCircle" placeholder="?">
                <button class="btn-main" onclick="checkCircle()">æäº¤</button>
            </div>
            <div class="puzzle-piece" id="puzzle1">ğŸ§©</div>
        </div>

        <div class="calc-box">
            <div>
                <strong>ä»»åŠ¡ 2ï¼š</strong>ç®—å‡ºä¾§é¢é•¿æ–¹å½¢çš„é¢ç§¯<br>
                <small style="color:#666">å…¬å¼æç¤ºï¼šé•¿ $\times$ å®½ ($31.4 \times 10$)</small>
            </div>
            <div class="input-area">
                <input type="number" id="ansRect" placeholder="?">
                <button class="btn-main" onclick="checkRect()">æäº¤</button>
            </div>
            <div class="puzzle-piece" id="puzzle2">ğŸ§©</div>
        </div>
    </section>

    <section class="card" id="stage4">
        <h2>ç¬¬å››æ­¥ï¼šè§è¯çœŸç›¸</h2>
        <p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½ ç®—å‡ºçš„é¢ç§¯åŠ èµ·æ¥ï¼Œçœ‹çœ‹æ˜¯å¦ç­‰äºç¤¼ç›’çš„æ€»é¢ç§¯ï¼Ÿ</p>
        
        <div style="background:#fff3cd; padding:15px; border-radius:10px; margin-bottom:20px;">
            <ul>
                <li>è®¾è®¡å¸ˆç»™å‡ºçš„æ€»é¢ç§¯ï¼š<strong><span id="finalTotal"></span></strong></li>
                <li>ä½ çŒœæƒ³çš„å…¬å¼è®¡ç®—ç»“æœï¼š<strong id="userGuessResult" style="color:var(--primary)">???</strong></li>
            </ul>
        </div>

        <button class="btn-main" style="width:100%; padding:15px; font-size:1.2em;" onclick="revealTruth()">âœ¨ ç‚¹å‡»æ­æ™“çœŸç›¸</button>

        <div class="conclusion-box" id="conclusionBox">
            <h3>ğŸ‰ æ­å–œä½ ï¼ŒçŒœæƒ³ C æ˜¯æ­£ç¡®çš„ï¼</h3>
            <p style="font-size:1.2em;">
                åœ†æŸ±è¡¨é¢ç§¯ = <strong>åº•é¢ç§¯ $\times$ 2</strong> + <strong>ä¾§é¢ç§¯</strong>
            </p>
            <div style="margin:20px 0; font-size:1.5em; color:#ffd700;">
                $S_{è¡¨} = 2\pi r^2 + Ch$
            </div>
            <p>åˆšæ‰æˆ‘ä»¬éªŒè¯äº†ï¼š<br> $78.5 \times 2 + 314 = 471$ (æ­£å¥½ç­‰äºç¤¼ç›’æ€»é¢ç§¯)</p>
        </div>
    </section>

</div>

<script>
    // === æ•°æ®è®¾å®š ===
    const PI = 3.14;
    const r = 5;
    const h = 10;
    
    // æ­£ç¡®ç­”æ¡ˆè®¡ç®—
    const areaCircle = PI * r * r; // 78.5
    const lenRect = 2 * PI * r; // 31.4
    const areaRect = lenRect * h; // 314
    const totalArea = (areaCircle * 2) + areaRect; // 157 + 314 = 471

    // çŠ¶æ€è®°å½•
    let userGuessType = 0; // 1=RectOnly, 2=1Circle+Rect, 3=2Circle+Rect
    let solvedCircle = false;
    let solvedRect = false;

    // åˆå§‹åŒ–é¡µé¢æ˜¾ç¤º
    document.getElementById('totalAreaDisp').innerText = totalArea;
    document.getElementById('finalTotal').innerText = totalArea;

    // === 1. æ‹†ç¤¼ç›’é€»è¾‘ (ä¿®å¤ç‰ˆ) ===
    function unwrapGift() {
        const gift = document.getElementById('cylinderGift');
        const parts = document.getElementById('unwrappedParts');
        
        // éšè—åœ†æŸ±
        gift.style.display = 'none';
        
        // æ˜¾ç¤ºé›¶ä»¶ (ä½¿ç”¨ Flex å¸ƒå±€)
        parts.style.display = 'flex';
        
        // æ¿€æ´»ä¸‹ä¸€æ­¥
        activateCard('stage2');
    }

    // === 2. çŒœæƒ³é€»è¾‘ ===
    function selectGuess(type, btnElement) {
        userGuessType = type;
        
        // UI é€‰ä¸­æ•ˆæœ
        document.querySelectorAll('.guess-btn').forEach(b => b.classList.remove('selected'));
        btnElement.classList.add('selected');
        
        // æ˜¾ç¤ºåé¦ˆå¹¶æ¿€æ´»ä¸‹ä¸€æ­¥
        const feedback = document.getElementById('guessFeedback');
        feedback.style.display = 'block';
        feedback.innerText = "çŒœæƒ³å·²è®°å½•ï¼è¯·å‰å¾€ç¬¬ä¸‰æ­¥è®¡ç®—éªŒè¯ã€‚";
        
        activateCard('stage3');
        // æ»šåŠ¨ä¸€ä¸‹
        document.getElementById('stage3').scrollIntoView({behavior: 'smooth'});
    }

    // === 3. è®¡ç®—éªŒè¯é€»è¾‘ ===
    function checkCircle() {
        const val = parseFloat(document.getElementById('ansCircle').value);
        if(Math.abs(val - areaCircle) < 0.5) {
            solvedCircle = true;
            markCorrect('puzzle1', 'ansCircle');
            checkStage3Complete();
        } else {
            alert("ä¸å¯¹å“¦ï¼Œåœ†é¢ç§¯ = 3.14 Ã— 5 Ã— 5ï¼Œå†ç®—ç®—ï¼Ÿ");
        }
    }

    function checkRect() {
        const val = parseFloat(document.getElementById('ansRect').value);
        if(Math.abs(val - areaRect) < 1) {
            solvedRect = true;
            markCorrect('puzzle2', 'ansRect');
            checkStage3Complete();
        } else {
            alert("ä¸å¯¹å“¦ï¼Œé•¿æ–¹å½¢é¢ç§¯ = é•¿(31.4) Ã— å®½(10)ï¼Œå†ç®—ç®—ï¼Ÿ");
        }
    }

    function markCorrect(puzzleId, inputId) {
        document.getElementById(puzzleId).classList.add('unlocked');
        document.getElementById(inputId).disabled = true;
        document.getElementById(inputId).style.backgroundColor = '#dff9fb';
    }

    function checkStage3Complete() {
        if(solvedCircle && solvedRect) {
            activateCard('stage4');
            document.getElementById('stage4').scrollIntoView({behavior: 'smooth'});
        }
    }

    // === 4. æ­æ™“çœŸç›¸é€»è¾‘ ===
    function revealTruth() {
        const resultSpan = document.getElementById('userGuessResult');
        const box = document.getElementById('conclusionBox');
        
        // æ ¹æ®ç”¨æˆ·çš„çŒœæƒ³è®¡ç®—ç»“æœ
        let guessCalc = 0;
        let guessText = "";
        
        if(userGuessType === 1) {
            guessCalc = areaRect;
            guessText = `åªæœ‰é•¿æ–¹å½¢ (${areaRect})`;
        } else if(userGuessType === 2) {
            guessCalc = areaCircle + areaRect;
            guessText = `1ä¸ªåœ† + é•¿æ–¹å½¢ (${areaCircle + areaRect})`;
        } else {
            guessCalc = (areaCircle * 2) + areaRect;
            guessText = `2ä¸ªåœ† + é•¿æ–¹å½¢ (${guessCalc})`;
        }
        
        resultSpan.innerText = guessText;
        
        // æ˜¾ç¤ºæœ€ç»ˆç»“è®º
        box.style.display = 'block';
        MathJax.typesetPromise(); // æ¸²æŸ“å…¬å¼
        
        if(userGuessType !== 3) {
            // å¦‚æœçŒœé”™äº†
            box.querySelector('h3').innerText = `ä½ çš„çŒœæƒ³ç»“æœæ˜¯ ${guessCalc}ï¼Œä½†æ€»é¢ç§¯æ˜¯ ${totalArea}ã€‚`;
            box.querySelector('h3').innerHTML += "<br>æ­£ç¡®ç­”æ¡ˆåº”è¯¥æ˜¯ï¼š2ä¸ªåœ† + 1ä¸ªä¾§é¢ï¼";
        }
    }

    // å·¥å…·å‡½æ•°ï¼šæ¿€æ´»å¡ç‰‡
    function activateCard(id) {
        const card = document.getElementById(id);
        card.classList.remove('active'); // è§¦å‘é‡ç»˜
        void card.offsetWidth; 
        card.classList.add('active');
    }

</script>

</body>
</html>